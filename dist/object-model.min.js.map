{"version":3,"sources":["object-model.js"],"names":[],"mappings":"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","file":"object-model.min.js","sourcesContent":["// ObjectModel v3.0.0 - http://objectmodel.js.org\r\n;(function(global){\r\n// string constants\r\nconst\r\nOBJECT                = \"Object\",\r\nARRAY                 = \"Array\",\r\nSET                   = \"Set\",\r\nMAP                   = \"Map\",\t\r\nFUNCTION              = \"Function\",\r\nCONVENTION_CONSTANT   = \"conventionForConstant\",\r\nCONVENTION_PRIVATE    = \"conventionForPrivate\",\r\nDEFINITION            = \"definition\",\r\nASSERTIONS            = \"assertions\",\r\nON_FAIL               = \"_onFail\",\r\nVALIDATE              = \"validate\",\r\nVALIDATOR             = \"_validator\",\r\nTEST                  = \"test\",\r\nEXTEND                = \"extend\",\r\nEXPECTED              = \"expected\",\r\nRECEIVED              = \"received\",\r\nPATH                  = \"path\",\r\nMESSAGE               = \"message\",\r\nERROR_STACK           = \"errorStack\",\r\nERROR_COLLECTOR       = \"errorCollector\",\r\nUNSTACK_ERRORS        = \"unstackErrors\",\r\nPROTO                 = \"prototype\",\r\nCONSTRUCTOR           = \"constructor\",\t\r\nDEFAULT               = \"default\",\r\nDEFAULTS              = \"defaults\",\r\nRETURN                = \"return\",\r\nARGS                  = \"arguments\",\r\n\r\nARRAY_MUTATOR_METHODS = [\"pop\", \"push\", \"reverse\", \"shift\", \"sort\", \"splice\", \"unshift\"],\r\nSET_MUTATOR_METHODS   = [\"add\", \"delete\", \"clear\"],\t\r\nMAP_MUTATOR_METHODS   = [\"set\", \"delete\", \"clear\"]\r\nconst defineProperty = Object.defineProperty;\r\n\r\nfunction is(Constructor, obj){\r\n\treturn obj instanceof Constructor;\r\n}\r\n\r\nfunction isFunction(o){\r\n\treturn typeof o === \"function\"\r\n}\r\n\r\nfunction isObject(o){\r\n    return typeof o === \"object\"\r\n}\r\n\r\nfunction isPlainObject(o){\r\n\treturn o && isObject(o) && Object.getPrototypeOf(o) === Object.prototype\r\n}\r\n\r\nfunction bettertypeof(obj){\r\n\treturn ({}).toString.call(obj).match(/\\s([a-zA-Z]+)/)[1]\r\n}\r\n\r\nfunction deepAssign(target, src) {\r\n\tObject.keys(src || {}).forEach(key => {\r\n\t\tif(isPlainObject(src[key])){\r\n\t\t\tconst o = {}\r\n\t\t\tdeepAssign(o, target[key])\r\n\t\t\tdeepAssign(o, src[key])\r\n\t\t\ttarget[key] = o\r\n\t\t} else {\r\n\t\t\ttarget[key] = src[key]\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction define(obj, key, value, enumerable) {\r\n\tdefineProperty(obj, key, { value, enumerable, writable: true, configurable: true })\r\n}\r\n\r\nfunction setConstructor(model, constructor){\r\n\tObject.setPrototypeOf(model, constructor[PROTO])\r\n\tdefine(model, CONSTRUCTOR, constructor)\r\n}\r\n\r\nfunction setConstructorProto(constructor, proto){\r\n\tconstructor[PROTO] = Object.create(proto)\r\n\tconstructor[PROTO][CONSTRUCTOR] = constructor\r\n}\r\n\r\nfunction toString(obj, stack = []){\r\n\tif(stack.length > 15 || stack.includes(obj)) return '...'\r\n\tif(obj == null) return String(obj)\r\n\tif(typeof obj == \"string\") return `\"${obj}\"`\r\n\tif(is(Model, obj)) return obj.toString(stack)\r\n\tstack = [obj].concat(stack)\r\n\tif(isFunction(obj)) return obj.name || obj.toString(stack)\r\n\tif(is(Array, obj)) return `[${obj.map(item => toString(item, stack)).join(', ')}]`\r\n\tif(obj.toString !== Object.prototype.toString) return obj.toString();\r\n\tif(obj && isObject(obj)) {\r\n\t\tconst props = Object.keys(obj),\r\n\t\t\t  indent = '\\t'.repeat(stack.length)\r\n\t\treturn `{${props.map(\r\n\t\t\tkey => `\\n${indent+key}: ${toString(obj[key], stack)}`\r\n\t\t).join(',')} ${props.length ? `\\n${indent.slice(1)}` : ''}}`\r\n\t}\r\n\treturn String(obj)\r\n}\r\nfunction Model(def){\r\n\tif(!isLeaf(def)) return Model[OBJECT](def)\r\n\r\n\tconst model = function(obj=model[DEFAULT]) {\r\n\t\tmodel[VALIDATE](obj)\r\n\t\treturn obj\r\n\t}\r\n\r\n\tinitModel(model, def, Model)\r\n\treturn model\r\n}\r\n\r\nsetConstructorProto(Model, Function[PROTO])\r\n\r\nObject.assign(Model[PROTO], {\r\n\ttoString(stack){\r\n\t\treturn parseDefinition(this[DEFINITION]).map(d => toString(d, stack)).join(\" or \")\r\n\t},\r\n\r\n\t[ASSERTIONS]: [],\r\n\r\n\t[VALIDATE](obj, errorCollector){\r\n\t\tthis[VALIDATOR](obj, null, this[ERROR_STACK], [])\r\n\t\tthis[UNSTACK_ERRORS](errorCollector)\r\n\t},\r\n\r\n\t[TEST](obj){\r\n\t\tconst errorStack = []\r\n\t\tthis[VALIDATOR](obj, null, errorStack, [])\r\n\t\treturn !errorStack.length\r\n\t},\r\n\r\n\t[EXTEND](){\r\n\t\tlet def, proto, assertions = [...this[ASSERTIONS]]\r\n\t\tconst args = [...arguments]\r\n\r\n\t\tif(is(Model[OBJECT], this)){\r\n\t\t\tdef = {}\r\n\t\t\tproto = {}\r\n\t\t\tObject.assign(def, this[DEFINITION])\r\n\t\t\tObject.assign(proto, this[PROTO])\r\n\t\t\targs.forEach(arg => {\r\n\t\t\t\tif(is(Model, arg)){\r\n\t\t\t\t\tdeepAssign(def, arg[DEFINITION])\r\n\t\t\t\t\tdeepAssign(proto, arg[PROTO])\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeepAssign(def, arg)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tdef = args\r\n\t\t\t\t.reduce((def, ext) => def.concat(parseDefinition(ext)), parseDefinition(this[DEFINITION]))\r\n\t\t\t\t.filter((value, index, self) => self.indexOf(value) === index) // remove duplicates\r\n\t\t}\r\n\r\n\t\targs.forEach(arg => {\r\n\t\t\tif(is(Model, arg)) assertions = assertions.concat(arg[ASSERTIONS])\r\n\t\t})\r\n\r\n\t\tconst submodel = new this[CONSTRUCTOR](def)\r\n\t\tsetConstructorProto(submodel, this[PROTO])\r\n\t\tObject.assign(submodel[PROTO], proto)\r\n\t\tsubmodel[ASSERTIONS] = assertions\r\n\t\tsubmodel[ERROR_COLLECTOR] = this[ERROR_COLLECTOR]\r\n\t\treturn submodel\r\n\t},\r\n\r\n\tassert(assertion, description = toString(assertion)){\r\n\t\tconst onFail = isFunction(description) ? description : (assertionResult, value) =>\r\n\t\t\t`assertion \"${description}\" returned ${toString(assertionResult)} for value ${toString(value)}`\r\n\t\tdefine(assertion, ON_FAIL, onFail)\r\n\t\tthis[ASSERTIONS] = this[ASSERTIONS].concat(assertion)\r\n\t\treturn this\r\n\t},\r\n\r\n\tdefaultTo(val){\r\n\t\tthis[DEFAULT] = val;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t[ERROR_COLLECTOR](errors){\r\n\t\tthrow new TypeError(errors.map(function(e){ return e[MESSAGE] }).join('\\n'))\r\n\t},\r\n\r\n\t[VALIDATOR](obj, path, errorStack, callStack){\r\n\t\tcheckDefinition(obj, this[DEFINITION], path, errorStack, callStack)\r\n\t\tcheckAssertions(obj, this, errorStack)\r\n\t},\r\n\r\n\t// throw all errors collected\r\n\t[UNSTACK_ERRORS](errorCollector){\r\n\t\tif (!this[ERROR_STACK].length) return\r\n\t\tif (!errorCollector) errorCollector = this.errorCollector\r\n\t\tconst errors = this[ERROR_STACK].map(err => {\r\n\t\t\tif (!err[MESSAGE]) {\r\n\t\t\t\tconst def = is(Array, err[EXPECTED]) ? err[EXPECTED] : [err[EXPECTED]]\r\n\t\t\t\terr[MESSAGE] = (\"expecting \" + (err[PATH] ? err[PATH] + \" to be \" : \"\") + def.map(d => toString(d)).join(\" or \")\r\n\t\t\t\t+ \", got \" + (err[RECEIVED] != null ? bettertypeof(err[RECEIVED]) + \" \" : \"\") + toString(err[RECEIVED]))\r\n\t\t\t}\r\n\t\t\treturn err\r\n\t\t})\r\n\t\tthis[ERROR_STACK] = []\r\n\t\terrorCollector.call(this, errors)\r\n\t}\r\n\r\n})\r\n\r\nModel[CONVENTION_CONSTANT] = key => key.toUpperCase() === key\r\nModel[CONVENTION_PRIVATE] = key => key[0] === \"_\"\r\n\r\nconst isLeaf = def => bettertypeof(def) != \"Object\"\r\n\r\nfunction initModel(model, def, constructor){\r\n\tsetConstructor(model, constructor)\r\n\tmodel[DEFINITION] = def\r\n\tmodel[ASSERTIONS] = model[ASSERTIONS].slice();\r\n\tdefine(model, ERROR_STACK, [])\r\n}\r\n\r\nfunction parseDefinition(def){\r\n\tif(isLeaf(def)){\r\n\t\tif(!is(Array, def)) return [def]\r\n\t\telse if(def.length === 1) return [...def, undefined, null]\r\n\t} else {\r\n\t\tfor(let key of def) def[key] = parseDefinition(def[key])\r\n\t}\r\n\treturn def\r\n}\r\n\r\nfunction checkDefinition(obj, def, path, errorStack, callStack){\r\n\tif(is(Model, def)){\r\n\t\tconst indexFound = callStack.indexOf(def)\r\n\t\t//if found twice in call stack, cycle detected, skip validation\r\n\t\tif(indexFound !== -1 && callStack.indexOf(def, indexFound+1) !== -1) return\r\n\t\treturn def[VALIDATOR](obj, path, errorStack, callStack.concat(def))\r\n\t}\r\n\telse if(isLeaf(def)){\r\n\t\tconst pdef = parseDefinition(def)\r\n\t\tif(pdef.some(part => checkDefinitionPart(obj, part, path, callStack))) return\r\n\t\terrorStack.push({\r\n\t\t\t[EXPECTED]: def,\r\n\t\t\t[RECEIVED]: obj,\r\n\t\t\t[PATH]: path\r\n\t\t})\r\n\t} else {\r\n\t\tObject.keys(def).forEach(key => {\r\n\t\t\tconst val = obj != null ? obj[key] : undefined\r\n\t\t\tcheckDefinition(val, def[key], path ? path + '.' + key : key, errorStack, callStack)\r\n\t\t})\r\n\t}\r\n}\r\n\r\nfunction checkDefinitionPart(obj, def, path, callStack){\r\n\tif(obj == null) return obj === def\r\n\tif(!isLeaf(def) || is(Model, def)){ // object or model as part of union type\r\n\t\tconst errorStack = []\r\n\t\tcheckDefinition(obj, def, path, errorStack, callStack)\r\n\t\treturn !errorStack.length\r\n\t}\r\n\tif(is(RegExp, def)) return def[TEST](obj)\r\n\tif(def === Number || def === Date) return obj[CONSTRUCTOR] === def && !isNaN(obj)\r\n\treturn obj === def\r\n\t\t|| (isFunction(def) && is(def, obj))\r\n\t\t|| obj[CONSTRUCTOR] === def\r\n}\r\n\r\nfunction checkAssertions(obj, model, errorStack = model[ERROR_STACK]){\r\n\tfor(let assertion of model[ASSERTIONS]){\r\n\t\tlet assertionResult;\r\n\t\ttry {\r\n\t\t\tassertionResult = assertion.call(model, obj)\r\n\t\t} catch(err){\r\n\t\t\tassertionResult = err\r\n\t\t}\r\n\t\tif(assertionResult !== true){\r\n\t\t\terrorStack.push({\r\n\t\t\t\t[MESSAGE]: assertion[ON_FAIL].call(model, assertionResult, obj)\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\nModel[OBJECT] = function ObjectModel(def){\r\n\r\n\tconst model = function(obj = model[DEFAULT]) {\r\n\t\tif(!is(model, this)) return new model(obj)\r\n\t\tdeepAssign(this, obj)\r\n\t\tconst proxy = getProxy(model, this, model[DEFINITION])\r\n\t\tmodel[VALIDATE](proxy)\r\n\t\treturn proxy\r\n\t}\r\n\r\n\tsetConstructorProto(model, Object[PROTO])\r\n\tinitModel(model, def, Model[OBJECT])\r\n\treturn model\r\n}\r\n\r\nsetConstructorProto(Model[OBJECT], Model[PROTO])\r\n\r\nObject.assign(Model[OBJECT][PROTO], {\r\n\r\n\t[DEFAULTS](p){\r\n\t\tObject.assign(this[PROTO], p)\r\n\t\treturn this\r\n\t},\r\n\r\n\ttoString(stack){\r\n\t\treturn toString(this[DEFINITION], stack)\r\n\t},\r\n\r\n\t[VALIDATOR](obj, path, errorStack, callStack){\r\n\t\tif(!isObject(obj)){\r\n\t\t\terrorStack.push({\r\n\t\t\t\t[EXPECTED]: this,\r\n\t\t\t\t[RECEIVED]: obj,\r\n\t\t\t\t[PATH]: path\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tcheckDefinition(obj, this[DEFINITION], path, errorStack, callStack)\r\n\t\t}\r\n\t\tcheckAssertions(obj, this)\r\n\t}\r\n})\r\n\r\nfunction getProxy(model, obj, defNode, path) {\r\n\tif(is(Model, defNode) && obj && !is(defNode, obj))\r\n\t\treturn defNode(obj)\r\n\telse if(is(Array, defNode)){ // union type\r\n\t\tlet suitableModels = []\r\n\t\tfor(let part of defNode.filter(part => is(Model, part))){\r\n\t\t\tif(is(part, obj)) return obj\r\n\t\t\tif(part.test(obj)) suitableModels.push(part)\r\n\t\t}\r\n\t\tif(suitableModels.length === 1)\r\n\t\t\treturn suitableModels[0](obj); // automatically cast to suitable model when explicit\r\n\t\telse if(suitableModels.length > 1)\r\n\t\t\tconsole.warn(`Ambiguous model for value ${toString(obj)},\r\n\t\t\t could be ${suitableModels.join(\" or \")}`);\r\n\t\treturn obj;\r\n\t}\r\n\telse if(isLeaf(defNode))\r\n\t\treturn obj\r\n\r\n\treturn new Proxy(obj || {}, {\r\n\t\tget(o, key) {\r\n\t\t\tconst newPath = (path ? path + '.' + key : key);\r\n\t\t\treturn getProxy(model, o[key], defNode[key], newPath);\r\n\t\t},\r\n\t\tset(o, key, val) {\r\n\t\t\tconst newPath = (path ? path + '.' + key : key),\r\n\t\t\t\t  isConstant = Model[CONVENTION_CONSTANT](key),\r\n\t\t\t\t  initialValue = o[key];\r\n\t\t\t\r\n\t\t\tif(isConstant && initialValue !== undefined){\r\n\t\t\t\tmodel[ERROR_STACK].push({\r\n\t\t\t\t\t[MESSAGE]: `cannot redefine constant ${key}`\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif(defNode.hasOwnProperty(key)){\r\n\t\t\t\tconst newProxy = getProxy(model, val, defNode[key], newPath)\r\n\t\t\t\tcheckDefinition(newProxy, defNode[key], newPath, model[ERROR_STACK], [])\r\n\t\t\t\to[key] = newProxy\r\n\t\t\t\tcheckAssertions(obj, model)\r\n\t\t\t} else {\r\n\t\t\t\tmodel[ERROR_STACK].push({\r\n\t\t\t\t\t[MESSAGE]: `cannot find property ${newPath} in the model definition`\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\r\n\t\t\tif(model[ERROR_STACK].length){\r\n\t\t\t\to[key] = initialValue\r\n\t\t\t\tmodel[UNSTACK_ERRORS]()\r\n\t\t\t}\r\n\t\t},\r\n\t\thas(o, key){\r\n\t\t\treturn Reflect.has(o, key) && !Model[CONVENTION_PRIVATE](key)\r\n\t\t},\r\n\t\townKeys(o){\r\n\t\t\treturn Reflect.ownKeys(o).filter(key => !Model[CONVENTION_PRIVATE](key))\r\n\t\t},\r\n\t\tgetPrototypeOf(){\r\n\t\t\treturn model[PROTO];\r\n\t\t}\r\n\t});\r\n}\r\nModel[ARRAY] = function ArrayModel(def){\r\n\r\n\tconst model = function(array = model[DEFAULT]) {\r\n\t\tmodel[VALIDATE](array)\r\n\t\treturn new Proxy(array, {\r\n\t\t\tget(arr, key) {\r\n\t\t\t\tif (key === CONSTRUCTOR)\r\n\t\t\t\t\treturn model\r\n\t\t\t\telse if (ARRAY_MUTATOR_METHODS.includes(key))\r\n\t\t\t\t\treturn proxifyArrayMethod(arr, key, model)\r\n\t\t\t\treturn arr[key]\r\n\t\t\t},\r\n\t\t\tset(arr, key, val) {\r\n\t\t\t\tsetArrayKey(arr, key, val, model)\r\n\t\t\t},\r\n\t\t\tgetPrototypeOf(){\r\n\t\t\t\treturn model[PROTO];\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tsetConstructorProto(model, Array[PROTO])\r\n\tinitModel(model, def, Model[ARRAY])\r\n\treturn model\r\n}\r\n\r\nsetConstructorProto(Model[ARRAY], Model[PROTO])\r\nObject.assign(Model[ARRAY][PROTO], {\r\n\r\n\ttoString(stack){\r\n\t\treturn ARRAY + ' of ' + toString(this[DEFINITION], stack)\r\n\t},\r\n\r\n\t[VALIDATOR](arr, path, errorStack, callStack){\r\n\t\tif(is(Array, arr))\r\n\t\t\tarr.forEach((item,i) => checkDefinition(item, this[DEFINITION], `${path||ARRAY}[${i}]`, errorStack, callStack))\r\n\t\telse errorStack.push({\r\n\t\t\t[EXPECTED]: this,\r\n\t\t\t[RECEIVED]: arr,\r\n\t\t\t[PATH]: path\r\n\t\t})\r\n\t\tcheckAssertions(arr, this)\r\n\t}\r\n})\r\n\r\nfunction proxifyArrayMethod(array, method, model){\r\n\treturn function() {\r\n\t\tconst testArray = array.slice()\r\n\t\tArray[PROTO][method].apply(testArray, arguments)\r\n\t\tmodel[VALIDATE](testArray)\r\n\t\treturn Array[PROTO][method].apply(array, arguments)\r\n\t}\r\n}\r\n\r\nfunction setArrayKey(array, key, value, model){\r\n\tif(parseInt(key) === +key && key >= 0){\r\n\t\tcheckDefinition(value, model[DEFINITION], ARRAY+'['+key+']', model[ERROR_STACK], [])\r\n\t}\r\n\tconst testArray = array.slice()\r\n\ttestArray[key] = value\r\n\tcheckAssertions(testArray, model)\r\n\tmodel[UNSTACK_ERRORS]()\r\n\tarray[key] = value\r\n}\r\nModel[FUNCTION] = function FunctionModel(){\r\n\r\n\tconst model = function(fn = model[DEFAULT]) {\r\n\t\tconst def = model[DEFINITION]\r\n\t\tconst proxyFn = function () {\r\n\t\t\tconst args = [];\r\n\t\t\tObject.assign(args, def[DEFAULTS])\r\n\t\t\tObject.assign(args, [...arguments])\r\n\t\t\tif (args.length > def[ARGS].length) {\r\n\t\t\t\tmodel[ERROR_STACK].push({\r\n\t\t\t\t\t[EXPECTED]: toString(fn) + \" to be called with \" + def[ARGS].length + \" \"+ARGS,\r\n\t\t\t\t\t[RECEIVED]: args.length\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tdef[ARGS].forEach((argDef, i) => checkDefinition(args[i], argDef, `${ARGS}[${i}]`, model[ERROR_STACK], []))\r\n\t\t\tcheckAssertions(args, model)\r\n\r\n\t\t\tlet returnValue;\r\n\t\t\tif(!model[ERROR_STACK].length){\r\n\t\t\t\treturnValue = fn.apply(this, args)\r\n\t\t\t\tif (RETURN in def)\r\n\t\t\t\t\tcheckDefinition(returnValue, def[RETURN], RETURN+' value', model[ERROR_STACK], [])\r\n\t\t\t}\r\n\t\t\tmodel[UNSTACK_ERRORS]()\r\n\t\t\treturn returnValue\r\n\t\t}\r\n\t\tsetConstructor(proxyFn, model)\r\n\t\treturn proxyFn\r\n\t}\r\n\r\n\tsetConstructorProto(model, Function[PROTO])\r\n\r\n\tconst def = { [ARGS]: [...arguments] }\r\n\tinitModel(model, def, Model[FUNCTION])\r\n\treturn model\r\n}\r\n\r\nsetConstructorProto(Model[FUNCTION], Model[PROTO])\r\n\r\nObject.assign(Model[FUNCTION][PROTO], {\r\n\r\n\ttoString(stack){\r\n\t\tlet out = FUNCTION + '(' + this[DEFINITION][ARGS].map(argDef => toString(argDef, stack)).join(\",\") +')'\r\n\t\tif(RETURN in this[DEFINITION]) {\r\n\t\t\tout += \" => \" + toString(this[DEFINITION][RETURN])\r\n\t\t}\r\n\t\treturn out\r\n\t},\r\n\r\n\t[RETURN](def){\r\n\t\tthis[DEFINITION][RETURN] = def\r\n\t\treturn this\r\n\t},\r\n\r\n\t[DEFAULTS](){\r\n\t\tthis[DEFINITION][DEFAULTS] = [...arguments]\r\n\t\treturn this\r\n\t},\r\n\t[VALIDATOR](f, path, errorStack){\r\n\t\tif (!isFunction(f)) {\r\n\t\t\terrorStack.push({\r\n\t\t\t\t[EXPECTED]: FUNCTION,\r\n\t\t\t\t[RECEIVED]: f,\r\n\t\t\t\t[PATH]: path\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n})\r\n\r\nglobal.Model = Model;\r\n})(this);"]}